{% extends 'loja/main.html' %}
{% load static %}
{% block content %}
<div class="row">
    {% for produto in produtos %}
        <div class="col-lg-4">
            <img src="{{produto.imageURL}}" class="center-image">
            <div class="box-element produto">
                <img src="{{ produto.loja.imageURL }}" class="loja-imagem">
                <h6><strong>{{produto.nome}}</strong></h6>
                
                <hr>
                {% if user.is_authenticated %}
                    {% if lista_selecionada %}
                        <a href="{% url 'adicionar_a_lista' lista_selecionada.id produto.id %}" class="btn-add-wishlist">
                            <i class="fa fa-heart"></i> Favoritos
                        </a>
                    {% else %}
                        <button onclick="abrirModal('{{ produto.id }}')" class="btn-add-wishlist">
                            <i class="fa fa-heart"></i> Favoritos
                        </button>
                    {% endif %}
                {% else %}
                    <a href="{% url 'login' %}" class="btn-add-wishlist" id="favoritos-link">
                        <i class="fa fa-heart"></i> Favoritos
                    </a>
                {% endif %}
                
                <h4 class="preco-direita">R$ {{produto.preco|floatformat:2}}</h4>
            </div>
            
        </div>
    {% endfor %}
</div>

<div id="novaListaModal" style="display:none;">
    <form action="" method="post" id="formCriarLista">
        {% csrf_token %}
        <label for="nome_lista">Nome da Nova Lista:</label>
        <input type="text" id="nome_lista" name="nome_lista" required>

        <input type="hidden" id="produto_id_modal" name="produto_id" value="">
        <button type="submit">Criar Lista</button>
    </form>
    <button onclick="fecharModal()">Cancelar</button>
</div>

<script>
    function abrirModal(produtoId) {
    var formCriarLista = document.getElementById('formCriarLista');
    var produtoIdInput = document.getElementById('produto_id_modal');

    produtoIdInput.value = produtoId;
    document.getElementById('novaListaModal').style.display = 'block';

    if (produtoId) {
        formCriarLista.action = '/criar_lista/' + produtoId + '/';
    } else {
        formCriarLista.action = '/criar_lista/';
    }
}

    function fecharModal() {
        document.getElementById('novaListaModal').style.display = 'none';
    }
</script>



{% endblock content %}
